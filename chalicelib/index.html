<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css" integrity="sha512-SbiR/eusphKoMVVXysTKG/7VseWii+Y3FdHrt0EpKgpToZeemhqHeZeLWLhJutz/2ut2Vw1uQEj2MbRF+TVBUA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Query</title>
</head>
<body>
    <div class="container">
        <h1>Query</h1>
        <form>
            <div class="form-group">
                <label for="file">File: </label>
                <input type="text" name="file" id="file" value="/mnt/lambda/efs-sqlite/northwind.db">
            </div>
            <div class="form-group">
                <label for="token">Token: </label>
                <input type="text" name="token" id="token" value="SOME_TOKEN">
            </div>
            <div class="form-group">
                <label for="statement">Statement: </label>
                <div>
                    <textarea name="statement" id="statement" cols="30" rows="10">SELECT * FROM sqlite_master;</textarea>
                </div>
            </div>
            <button type="submit" class="btn btn-primary" id="submit">Submit</button>
        </form>
        <div id="result"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js" integrity="sha512-LUKzDoJKOLqnxGWWIBM4lzRBlxcva2ZTztO8bTcWPmDSpkErWx0bSP4pdsjNH8kiHAUPaT06UXcb+vOEZH+HpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        document.getElementById('submit').addEventListener('click', (event)=>{
            event.preventDefault();
            submitClicked();
        });
        async function submitClicked() {
            
            //var url = 'https://19cx2ehing.execute-api.us-east-1.amazonaws.com/api/query';
            var url = window.location.href + 'query'
            var payload = {
                'file': document.getElementById('file').value,
                'token': document.getElementById('token').value,
                'statement': document.getElementById('statement').value
            }
            var response = await axios.post(url, payload);
            document.getElementById('result').innerHTML = recordsToTable(response.data);
        }

        function recordsToTable(records) {
            var output = '';
            output += '<table class="table table-striped">';
            output += '<tr>';
            for(header of Object.keys(records[0])) output += `<th>${header}</th>`;
            output += '</tr>';
            for(record of records) {
                output += '<tr>';
                for(value of Object.values(record)) output += `<td>${value}</td>`;
                output += '</tr>';
            }
            output += '</table>';
            return output;
        }

    </script>
</body>
</html>